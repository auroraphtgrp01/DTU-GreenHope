/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

(function(t,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("@nocobase/client"),require("@formily/react"),require("react/jsx-runtime"),require("react"),require("@formily/shared"),require("@ant-design/icons")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","@formily/react","react/jsx-runtime","react","@formily/shared","@ant-design/icons"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t["@dtu-olp-2024/rich-block-nocobase"]={},t["@nocobase/client"],t["@formily/react"],t.jsxRuntime,t.react,t["@formily/shared"],t["@ant-design/icons"]))})(this,function(t,e,i,f,S,k,v){"use strict";var A=Object.defineProperty,L=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var B=(t,e,i)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,m=(t,e)=>{for(var i in e||(e={}))$.call(e,i)&&B(t,i,e[i]);if(D)for(var i of D(e))E.call(e,i)&&B(t,i,e[i]);return t},y=(t,e)=>L(t,V(e));var x=(t,e,i)=>new Promise((f,S)=>{var k=a=>{try{h(i.next(a))}catch(b){S(b)}},v=a=>{try{h(i.throw(a))}catch(b){S(b)}},h=a=>a.done?f(a.value):Promise.resolve(a.value).then(k,v);h((i=i.apply(t,e)).next())});const h="Header Picker",a=h.toLowerCase(),j={name:"@dtu-olp-2024/rich-block-nocobase",version:"1.0.0",license:"GPL-3.0",main:"dist/server/index.js",dependencies:{"@formily/react":"^2.3.2"},peerDependencies:{"@nocobase/client":"1.x","@nocobase/server":"1.x","@nocobase/test":"1.x"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},repository:{type:"git",url:"git+https://github.com/olp-dtu-2024/DTU-GreenHope"}};function P(){const o=e.useApp();return n=>o.i18n.t(n,{ns:[j.name,"client"]})}const N={name:"height",type:"actionModal",useComponentProps(){var s,p;const o=i.useFieldSchema(),{deepMerge:n}=e.useDesignable(),r=P();return{title:r("Edit Height"),schema:{type:"object",title:r("Edit Height"),properties:{height:{title:r("Height"),type:"number",default:(p=(s=o["x-decorator-props"])==null?void 0:s.myHeaderPicker)==null?void 0:p.height,"x-decorator":"FormItem","x-component":"InputNumber"}}},onSubmit({height:d}){var c;n({"x-uid":o["x-uid"],"x-decorator-props":y(m({},o["x-decorator-props"]),{myHeaderPicker:y(m({},(c=o["x-decorator-props"])==null?void 0:c.myHeaderPicker),{height:d})})})}}}},C=new e.SchemaSettings({name:`blockSettings:${a}`,items:[{name:e.SchemaSettingsDataScope.name,Component:e.SchemaSettingsDataScope,useComponentProps:()=>{var d,c;const o=e.useCollection(),n=e.useAPIClient(),r=i.useFieldSchema(),s=((c=(d=r==null?void 0:r["x-decorator-props"])==null?void 0:d.params)==null?void 0:c.filter)||{},{deepMerge:p}=e.useDesignable();return{collectionName:o.name,defaultFilter:s,onSubmit:l=>x(this,null,function*(){const u={"x-uid":r["x-uid"],"x-decorator-props":y(m({},r["x-decorator-props"]),{params:{filter:m(m({},s),l.filter)}})};yield n.request({url:"/uiSchemas:patch",method:"POST",data:u}).then(g=>{g.status===200&&p({"x-decorator-props":y(m({},r["x-decorator-props"]),{params:{filter:m(m({},s),l.filter)}})})})})}}},{type:"remove",name:"remove",componentProps:{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}},N]});function I(){const o=e.useCollection(),{data:n,loading:r}=e.useDataBlockRequest();return{collectionName:o.name,data:n==null?void 0:n.data,loading:r}}function z({dataSource:o="main",collection:n}){return{type:"void","x-decorator":"DataBlockProvider","x-decorator-props":{myHeaderPicker:{},dataSource:o,collection:n,action:"list"},"x-component":"CardItem","x-toolbar":"BlockSchemaToolbar","x-settings":C.name,"x-designer":"FormV2.Designer","x-component-props":{useConfigureFields:!0},"x-use-decorator-props":"useBlockScopeDecoratorProps",properties:{[a]:{type:"void","x-component":"HeaderPickerBlock",properties:{fields:{type:"void","x-component":"Grid","x-initializer":"info:configureFields"}}}}}}const H=new e.SchemaSettings({name:`fieldSettings:component:${a}`,items:[{type:"remove",name:"remove",componentProps:{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}},e.createSelectSchemaSettingsItem({name:"headerType",title:"Header Type",schemaKey:"x-component-props.headerType",defaultValue:"h1",useOptions(){return[{label:"Heading 1",value:"h1"},{label:"Heading 2",value:"h2"},{label:"Heading 3",value:"h3"},{label:"Heading 4",value:"h4"},{label:"Heading 5",value:"h5"},{label:"Heading 6",value:"h6"},{label:"Paragragh",value:"p"}]}})]}),M=({name:o})=>{var l;const{data:n,loading:r}=I(),s=i.useFieldSchema(),p=((l=s==null?void 0:s["x-component-props"])==null?void 0:l.headerType)||"h1",d=S.useMemo(()=>{if(!n)return"";if(Array.isArray(n)){const u=n.find(g=>g[o]);return u==null?void 0:u[o]}return n[o]},[n,o]),c=p;return r?f.jsx(c,{children:"Loading..."}):f.jsx(c,{children:d||"N/A"})};function q({name:o}){return{type:"void","x-collection-field":o,"x-component":"Grid.Row",properties:{[k.uid()]:{type:"void","x-component":"Grid.Col",properties:{[o]:{type:"void","x-component":"InfoField","x-component-props":{name:o,headerType:"h1"},"x-settings":H.name,"x-decorator":"FormItem"}}}}}}function w(o){var u;const{collectionField:n,schema:r,remove:s,insert:p}=o,d=((u=n.uiSchema)==null?void 0:u.title)||n.name,c=n.name,l=Object.values(r.properties||{}).find(g=>g["x-collection-field"]===c);return{name:c,title:d,type:"switch",checked:!!l,onClick(){if(l){s(l);return}p(q({name:c}))}}}const G=new e.SchemaInitializer({name:"info:configureFields",icon:"SettingOutlined",title:"Configure fields",items:[{type:"itemGroup",name:"fields",title:"Display fields",useChildren(){const o=e.useCollection(),{insert:n}=e.useSchemaInitializer(),{remove:r}=e.useDesignable(),s=i.useFieldSchema();return o.getFields().map(d=>w({collectionField:d,schema:s,remove:r,insert:n}))}}]}),F={name:a,Component:"DataBlockInitializer",useComponentProps(){const{insert:o}=e.useSchemaInitializer();return{title:P()(h),icon:f.jsx(v.CodeOutlined,{}),componentType:h,useTranslationHooks:P,onCreateBlockSchema({item:r}){o(z({dataSource:r.dataSource,collection:r.name}))}}}},O=({children:o})=>f.jsx("div",{children:o});class T extends e.Plugin{afterAdd(){return x(this,null,function*(){})}beforeLoad(){return x(this,null,function*(){})}load(){return x(this,null,function*(){this.app.addComponents({InfoField:M,HeaderPickerBlock:O}),this.app.schemaInitializerManager.add(G),this.app.addScopes({useHeaderPickerProps:I}),this.app.schemaSettingsManager.add(C,H),this.app.schemaInitializerManager.addItem("page:addBlock",`dataBlocks.${F.name}`,F)})}}t.HeaderPickerNocobaseClient=T,t.default=T,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
