/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

(function(t,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@nocobase/client"),require("react"),require("@formily/react"),require("react/jsx-runtime"),require("antd"),require("@ant-design/icons")):typeof define=="function"&&define.amd?define(["exports","@nocobase/client","react","@formily/react","react/jsx-runtime","antd","@ant-design/icons"],o):(t=typeof globalThis!="undefined"?globalThis:t||self,o(t["@dtu-olp-2024/carousel-nocobase"]={},t["@nocobase/client"],t.react,t["@formily/react"],t.jsxRuntime,t.antd,t["@ant-design/icons"]))})(this,function(t,o,a,p,f,y,P){"use strict";var V=Object.defineProperty,_=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var I=(t,o,a)=>o in t?V(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,l=(t,o)=>{for(var a in o||(o={}))N.call(o,a)&&I(t,a,o[a]);if(v)for(var a of v(o))M.call(o,a)&&I(t,a,o[a]);return t},h=(t,o)=>_(t,J(o));var T=(t,o)=>{var a={};for(var p in t)N.call(t,p)&&o.indexOf(p)<0&&(a[p]=t[p]);if(t!=null&&v)for(var p of v(t))o.indexOf(p)<0&&M.call(t,p)&&(a[p]=t[p]);return a};var k=(t,o,a)=>new Promise((p,f)=>{var y=n=>{try{g(a.next(n))}catch(b){f(b)}},P=n=>{try{g(a.throw(n))}catch(b){f(b)}},g=n=>n.done?p(n.value):Promise.resolve(n.value).then(y,P);g((a=a.apply(t,o)).next())});const g="Carousel",n=g.toLowerCase(),w={name:"@dtu-olp-2024/carousel-nocobase",version:"1.0.0",license:"GPL-3.0",main:"dist/server/index.js",peerDependencies:{"@nocobase/client":"1.x","@nocobase/server":"1.x","@nocobase/test":"1.x"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},repository:{type:"git",url:"git+https://github.com/olp-dtu-2024/DTU-GreenHope"}};function x(){const e=o.useApp();return s=>e.i18n.t(s,{ns:[w.name,"client"]})}const q={name:"height",type:"actionModal",useComponentProps(){var c,u;const e=p.useFieldSchema(),{deepMerge:s}=o.useDesignable(),r=x();return{title:r("Edit Height"),schema:{type:"object",title:r("Edit Height"),properties:{height:{title:r("Height"),type:"number",default:(u=(c=e["x-decorator-props"])==null?void 0:c[n])==null?void 0:u.height,"x-decorator":"FormItem","x-component":"InputNumber"}}},onSubmit({height:d}){var i;s({"x-uid":e["x-uid"],"x-decorator-props":h(l({},e["x-decorator-props"]),{[n]:h(l({},(i=e["x-decorator-props"])==null?void 0:i[n]),{height:d})})})}}}},O={name:"objectFit",type:"select",useComponentProps(){var c,u;const e=p.useFieldSchema(),{deepMerge:s}=o.useDesignable();return{title:x()("Object Fit"),options:[{label:"Cover",value:"cover"},{label:"Contain",value:"contain"},{label:"Fill",value:"fill"},{label:"None",value:"none"},{label:"Scale Down",value:"scale-down"}],value:((u=(c=e["x-decorator-props"])==null?void 0:c[n])==null?void 0:u.objectFit)||"cover",onChange(d){var i;s({"x-uid":e["x-uid"],"x-decorator-props":h(l({},e["x-decorator-props"]),{[n]:h(l({},(i=e["x-decorator-props"])==null?void 0:i[n]),{objectFit:d})})})}}}},A={name:"autoplay",type:"switch",useComponentProps(){var c,u;const e=p.useFieldSchema(),{deepMerge:s}=o.useDesignable();return{title:x()("Autoplay"),checked:!!((u=(c=e["x-decorator-props"])==null?void 0:c[n])!=null&&u.autoplay),onChange(d){var i;s({"x-uid":e["x-uid"],"x-decorator-props":h(l({},e["x-decorator-props"]),{[n]:h(l({},(i=e["x-decorator-props"])==null?void 0:i[n]),{autoplay:d})})})}}}},D=new o.SchemaSettings({name:`blockSettings:${n}`,items:[{name:o.SchemaSettingsDataScope.name,Component:o.SchemaSettingsDataScope,useComponentProps:()=>{var d,i;const e=o.useCollection(),s=o.useAPIClient(),r=p.useFieldSchema(),c=((i=(d=r==null?void 0:r["x-decorator-props"])==null?void 0:d.params)==null?void 0:i.filter)||{},{deepMerge:u}=o.useDesignable();return{collectionName:e.name,defaultFilter:c,onSubmit:m=>k(this,null,function*(){const S={"x-uid":r["x-uid"],"x-decorator-props":h(l({},r["x-decorator-props"]),{params:{filter:l(l({},c),m.filter),appends:["images"]}})};yield s.request({url:"/uiSchemas:patch",method:"POST",data:S}).then(C=>{C.status===200&&u({"x-decorator-props":h(l({},r["x-decorator-props"]),{params:{filter:l(l({},c),m.filter),appends:["images"]}})})})})}}},{name:"editBlockTitle",Component:o.SchemaSettingsBlockTitleItem},{type:"remove",name:"remove",componentProps:{removeParentsIfNoChildren:!0,breakRemoveOn:{"x-component":"Grid"}}},q,O,A]});function H(e){var d;const{filter:s,parseVariableLoading:r}=o.useParsedFilter({filterOption:(d=e.params)==null?void 0:d.filter}),c=a.useMemo(()=>{var C,j;const i=[],m=(C=e.fieldNames)==null?void 0:C.start,S=(j=e.fieldNames)==null?void 0:j.end;return Array.isArray(m)&&m.length>=2&&i.push(m[0]),Array.isArray(S)&&S.length>=2&&i.push(S[0]),i},[e.fieldNames]);return{params:a.useMemo(()=>{var i;return h(l({},e.params),{appends:[...c,...((i=e.params)==null?void 0:i.appends)||[],"images"],filter:s})},[c,JSON.stringify(s),e.params]),parseVariableLoading:r}}function L(e){const{params:s,parseVariableLoading:r}=H(e);let c;return e.association&&(c=o.useParentRecordCommon(e.association)),{params:s,parentRecord:c,parseVariableLoading:r}}function z(){var s,r;return(r=(s=p.useFieldSchema().parent)==null?void 0:s["x-decorator-props"])==null?void 0:r[n]}const G=({dataSource:e="main",collection:s})=>({type:"void","x-decorator":"DataBlockProvider","x-component":"FormItem","x-settings":D.name,"x-toolbar":"BlockSchemaToolbar","x-decorator-props":{[n]:{},rowKey:"id",runWhenParamsChanged:!0,readPretty:!0,dataSource:e,collection:s,action:"list"},"x-use-decorator-props":"useBlockScopeDecoratorProps",properties:{[n]:{type:"void","x-component":g,"x-use-component-props":"useCarouselBlockProps"}}}),E=()=>{const{data:e}=o.useDataBlockRequest();return{images:e?(e==null?void 0:e.data)[0].images:[]}},R=o.withDynamicSchemaProps(e=>{const{images:s}=E(),i=e,{data:r,height:c=300,objectFit:u="cover"}=i,d=T(i,["data","height","objectFit"]);return s&&s.length?f.jsx(y.Carousel,h(l({},d),{children:s.map(m=>f.jsx("div",{children:f.jsx("img",{src:m.url,alt:m.title,style:{height:c,width:"100%",objectFit:u}},m.title)},m.url))})):f.jsx(y.Result,{status:"404"})},{displayName:g}),F={type:"item",name:n,Component:"DataBlockInitializer",icon:"PlayCircleOutlined",useComponentProps(){const{insert:e}=o.useSchemaInitializer();return{title:x()(g),icon:f.jsx(P.CodeOutlined,{}),componentType:g,useTranslationHooks:x,onCreateBlockSchema({item:r}){e(G({dataSource:r.dataSource,collection:r.name}))}}}};class B extends o.Plugin{load(){return k(this,null,function*(){this.app.addScopes({useBlockScopeDecoratorProps:L,useCarouselBlockProps:z}),this.app.addComponents({Carousel:R}),this.app.schemaSettingsManager.add(D),this.app.schemaInitializerManager.addItem("page:addBlock",`dataBlocks.${F.name}`,F)})}}t.CarouselNocobaseClient=B,t.default=B,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
